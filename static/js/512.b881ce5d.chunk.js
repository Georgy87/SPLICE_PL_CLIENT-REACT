"use strict";(self.webpackChunkreact_client=self.webpackChunkreact_client||[]).push([[512],{1512:function(e,n,a){a.r(n),a.d(n,{default:function(){return G}});var t=a(4165),r=a(5861),i=a(9439),o=a(2791),s=a(9434),u=function(e){return e.samples},c=function(e){return u(e).files},d=function(e){return u(e).packId},l=function(e){return u(e).files},f=a(3433),p=a(5671),v=a(3144),g=function(){function e(){(0,p.Z)(this,e)}return(0,v.Z)(e,[{key:"filterData",value:function(e){for(var n=e.getChannelData(0),a=Math.floor(n.length/550),t=[],r=0;r<550;r++){for(var i=a*r,o=0,s=0;s<a;s++)o+=Math.abs(n[i+s]);t.push(o/a)}return t}},{key:"normalizeData",value:function(e){var n=50/Math.max.apply(Math,(0,f.Z)(e));return e.map((function(e){return+(e*n+1).toFixed()}))}},{key:"sampleAudioData",value:function(e){return this.normalizeData(this.filterData(e))}}]),e}(),h=new g;var m,x=(0,v.Z)((function e(n){(0,p.Z)(this,e);var a=n.toString();a=a.substring(a.indexOf("{")+1,a.lastIndexOf("}"));var t=new Blob([a],{type:"application/javascript"});return new Worker(URL.createObjectURL(t))})),k=new x((function(){onmessage=function(n){var a=n.data,t=a.audioCoordinates,r=a.audioFile,i=a.canvas,o=a.packId,s=a.cssCanvasWidth,u=a.cssCanvasHeight,c=a.dpr,d=a.fileId,l=a.duration,f=n.data.canvas.getContext("2d");if(null!==n.data.canvas){i.width=s*c,i.height=u*c,null===f||void 0===f||f.scale(c,c),null===f||void 0===f||f.translate(0,u/2);var p=s/t.length;f.strokeStyle="#ADD8E6",f.beginPath();for(var v=0;v<t.length;v++){var g=p*v,h=t[v];e(f,g,h,p,i)}f.stroke(),i.convertToBlob({type:"image/png"}).then((function(e){return function(e){var n=new File([e],"png",{type:"png"});postMessage({imageFile:n,audioFile:r,audioCoordinates:t,packId:o,fileId:d,duration:l})}(e)}))}};var e=function(e,n,a,t){e.fillStyle="#ADD8E6",e.fillRect(n+t/2,-a/2,.6,a)}})),y=(new x((function(){onmessage=function(n){var a=n.data,t=a.audioCoordinates,r=a.cssCanvasWidth,i=a.cssCanvasHeight,o=a.dpr,s=n.data.canvas.getContext("2d"),u=n.data.canvas;if(null!==n.data.canvas){u.width=r*o,u.height=i*o,null===s||void 0===s||s.scale(o,o),null===s||void 0===s||s.translate(0,i/2);var c=r/t.length;s.strokeStyle="red",s.beginPath();for(var d=0;d<t.length;d++){var l=c*d,f=t[d];e(s,l,f,c)}postMessage({audioCoordinates:t})}};var e=function(e,n,a,t){e.fillRect(n+t/2,-a/2,2,a),e.fillStyle="red"}})),a(3502)),C=a(3730),w=a(3214),b=function(){var e=(0,r.Z)((0,t.Z)().mark((function e(n){var a,r,i,o,s,u,c,d;return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.imageFile,r=n.audioFile,i=n.audioCoordinates,o=n.packId,s=n.fileId,u=n.duration,e.prev=1,!a||!r){e.next=12;break}return(c=new FormData).append("image",a),c.append("audio",r),c.append("coordinates",JSON.stringify(i)),c.append("duration",JSON.stringify(u)),e.next=10,w.S.create({packId:o,fileId:s},c).promise;case 10:return d=e.sent,e.abrupt("return",d);case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),console.log(e.t0);case 17:case"end":return e.stop()}}),e,null,[[1,14]])})));return function(n){return e.apply(this,arguments)}}(),I=a(6581),_=a(184),j=function(e){var n=e.file,a=e.fileId,i=(0,s.v9)(d),u=function(){var e="Other",n=function(e){return navigator.userAgent.indexOf(e)};if(-1!==n("YaBrowser"))e="Yandex Browser";else if(-1!==n("Firefox"))e="Mozilla Firefox";else if(-1!==n("MSIE"))e="Internet Exploder";else if(-1!==n("Edge"))e="Microsoft Edge";else if(-1!==n("Safari")){if(-1!==n("Chrome")&&-1!==n("Safari"))return"Chrome";e="Safari"}else-1!==n("Opera")&&(e="Opera");return e}(),c=(0,I.T)(),l=(0,o.useRef)(null);return(0,o.useEffect)((function(){var e=new FileReader,o=new AudioContext;e.readAsArrayBuffer(n),window.AudioContext=window.AudioContext||new window.webkitAudioContext,e.onload=(0,r.Z)((0,t.Z)().mark((function r(){var s,d,f,p,v,g,m;return(0,t.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=e.result){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,o.decodeAudioData(s);case 5:if(d=t.sent,f=h.sampleAudioData(d),"Safari"!==u){t.next=18;break}if(p=null===l||void 0===l?void 0:l.current,v=y.X.drawingCanvasToImage(n,f,i,p,a,d.duration)){t.next=12;break}return t.abrupt("return");case 12:return t.next=14,b(v);case 14:if(g=t.sent){t.next=17;break}return t.abrupt("return");case 17:c((0,C.b2)(g));case 18:if(null!==l&&void 0!==l&&l.current){t.next=20;break}return t.abrupt("return");case 20:m=null===l||void 0===l?void 0:l.current.transferControlToOffscreen(),k.postMessage({audioFile:n,audioCoordinates:f,packId:i,canvas:m,cssCanvasWidth:550,cssCanvasHeight:50,dpr:2,fileId:a,duration:d.duration},[m]);case 22:case"end":return t.stop()}}),r)})))}),[]),(0,_.jsx)(_.Fragment,{children:(0,_.jsx)("canvas",{ref:l,style:{width:"550px",height:"35px"}})})},D=function(){var e=(0,s.v9)(c);return(0,_.jsx)(_.Fragment,{children:e.map((function(e,n){var a=e.file,t=e.id;return(0,_.jsx)(j,{file:a,fileId:t},n)}))})},S=a(7689),E=new Uint8Array(16);function F(){if(!m&&!(m="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!==typeof msCrypto&&"function"===typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return m(E)}var O=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var P=function(e){return"string"===typeof e&&O.test(e)},A=[],Z=0;Z<256;++Z)A.push((Z+256).toString(16).substr(1));var L=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=(A[e[n+0]]+A[e[n+1]]+A[e[n+2]]+A[e[n+3]]+"-"+A[e[n+4]]+A[e[n+5]]+"-"+A[e[n+6]]+A[e[n+7]]+"-"+A[e[n+8]]+A[e[n+9]]+"-"+A[e[n+10]]+A[e[n+11]]+A[e[n+12]]+A[e[n+13]]+A[e[n+14]]+A[e[n+15]]).toLowerCase();if(!P(a))throw TypeError("Stringified UUID is invalid");return a};var U=function(e,n,a){var t=(e=e||{}).random||(e.rng||F)();if(t[6]=15&t[6]|64,t[8]=63&t[8]|128,n){a=a||0;for(var r=0;r<16;++r)n[a+r]=t[r];return n}return L(t)},R=a(2419),M=a(3484),N=a(7900),T="UserPackItem_drop__iQWB7",B="UserPackItem_dropSamples__bEFD2",W="UserPackItem_packCardWrapper__XeXuI",z="UserPackItem_packCard__nBKIZ",H="UserPackItem_changePage__UrzTT",V="UserPackItem_uploadSamples__+sldL",X=function(e){var n=e.pack,a=(e.index,e.id),t=(0,R.u)(),r=t.drag,i=t.setDrag,s=t.dragEnter,u=t.dragLeave,c=(0,o.useRef)(null),d=(0,S.s0)(),l=(0,I.T)();return(0,_.jsxs)("div",{className:"".concat(W," ").concat(H),children:[(0,_.jsxs)("div",{className:z,onClick:function(){return d("/profile-pack/".concat(null===n||void 0===n?void 0:n._id))},children:[(0,_.jsx)("img",{src:"".concat(n.picture),alt:"pack-cover"}),(0,_.jsxs)("div",{children:[(0,_.jsx)("div",{children:n.genre}),(0,_.jsx)("div",{style:{fontSize:12,color:"gray"},children:n.name})]})]}),(0,_.jsx)("div",{className:B,children:r?(0,_.jsx)("div",{className:T,onDragEnter:s,onDragLeave:u,onDragOver:s,onDrop:function(e){e.preventDefault(),e.stopPropagation();var n=[e.dataTransfer.files];i(!1),Object.values(n[0]).forEach((function(e){l((0,C.HP)({id:U(),file:e,packId:a}))}))},children:"DROP FILES"}):(0,_.jsx)("div",{onDragEnter:s,onDragLeave:u,onDragOver:s,children:"DOWNLOAD SAMPLES"})}),(0,_.jsxs)("div",{onClick:function(){var e;return null===(e=c.current)||void 0===e?void 0:e.click()},className:V,children:[(0,_.jsx)("input",{type:"file",accept:"audio/wav",style:{display:"none"},ref:c,multiple:!0,onChange:function(e){e.target.files&&Object.values(e.target.files).forEach((function(e){l((0,C.HP)({id:U(),file:e,packId:a}))}))}}),(0,_.jsxs)(M._,{typeStyle:"download",children:[(0,_.jsx)(N._,{iconName:"upload"}),"DOWNLOAD SAMPLES"]})]})]})},J=a(8003),Q=a(222),Y=a(2850),K=a(4261),$="UserPacksPage_root__ICou2",q="UserPacksPage_packCardContainer__t5FQp",G=function(){var e=(0,s.v9)(J.zL),n=(0,s.v9)(l),a=(0,o.useState)(!1),u=(0,i.Z)(a,2),c=u[0],d=u[1],f=(0,I.T)();return(0,o.useEffect)((function(){null!==n&&void 0!==n&&n.length?d(!0):d(!1)}),[n]),(0,o.useEffect)((function(){function e(e){return n.apply(this,arguments)}function n(){return(n=(0,r.Z)((0,t.Z)().mark((function e(n){var a,r,i,o,s,u,c,d;return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.data,r=a.imageFile,i=a.audioFile,o=a.audioCoordinates,s=a.packId,u=a.fileId,c=a.duration,e.next=3,b({imageFile:r,audioFile:i,audioCoordinates:o,packId:s,fileId:u,duration:c});case 3:if(d=e.sent){e.next=6;break}return e.abrupt("return");case 6:f((0,C.b2)(d));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return k.addEventListener("message",e),f((0,K.BD)()),function(){k.removeEventListener("message",e)}}),[]),(0,_.jsx)("div",{"data-testid":"user-packs-page",children:(0,_.jsxs)("div",{className:$,children:[(0,_.jsx)(Y.u,{setActive:d,active:c,children:(0,_.jsx)(Q.a,{})}),e.map((function(e,n){return(0,_.jsx)("div",{className:q,children:(0,_.jsx)(X,{pack:e,id:e._id,index:n})},e._id)})),(0,_.jsx)("div",{}),(0,_.jsx)(D,{})]})})}}}]);
//# sourceMappingURL=512.b881ce5d.chunk.js.map