"use strict";(self.webpackChunkreact_client=self.webpackChunkreact_client||[]).push([[658],{658:function(e,n,a){a.r(n),a.d(n,{default:function(){return G}});var r=a(4165),t=a(5861),i=a(9439),o=a(2791),s=a(9434),u=function(e){return e.samples},c=function(e){return u(e).files},d=function(e){return u(e).packId},l=function(e){return u(e).files},f=a(3433),p=a(5671),v=a(3144),g=function(){function e(){(0,p.Z)(this,e)}return(0,v.Z)(e,[{key:"filterData",value:function(e){for(var n=e.getChannelData(0),a=Math.floor(n.length/550),r=[],t=0;t<550;t++){for(var i=a*t,o=0,s=0;s<a;s++)o+=Math.abs(n[i+s]);r.push(o/a)}return r}},{key:"normalizeData",value:function(e){var n=50/Math.max.apply(Math,(0,f.Z)(e));return e.map((function(e){return+(e*n+1).toFixed()}))}},{key:"sampleAudioData",value:function(e){return this.normalizeData(this.filterData(e))}}]),e}(),h=new g;var m,x=(0,v.Z)((function e(n){(0,p.Z)(this,e);var a=n.toString();a=a.substring(a.indexOf("{")+1,a.lastIndexOf("}"));var r=new Blob([a],{type:"application/javascript"});return new Worker(URL.createObjectURL(r))})),k=new x((function(){onmessage=function(n){var a=n.data,r=a.audioCoordinates,t=a.audioFile,i=a.canvas,o=a.packId,s=a.cssCanvasWidth,u=a.cssCanvasHeight,c=a.dpr,d=a.fileId,l=a.duration,f=n.data.canvas.getContext("2d");if(null!==n.data.canvas){i.width=s*c,i.height=u*c,null===f||void 0===f||f.scale(c,c),null===f||void 0===f||f.translate(0,u/2);var p=s/r.length;f.strokeStyle="#ADD8E6",f.beginPath();for(var v=0;v<r.length;v++){var g=p*v,h=r[v];e(f,g,h,p,i)}f.stroke(),i.convertToBlob({type:"image/png"}).then((function(e){return function(e){var n=new File([e],"png",{type:"png"});postMessage({imageFile:n,audioFile:t,audioCoordinates:r,packId:o,fileId:d,duration:l})}(e)}))}};var e=function(e,n,a,r){e.fillStyle="#ADD8E6",e.fillRect(n+r/2,-a/2,.6,a)}})),y=(new x((function(){onmessage=function(n){var a=n.data,r=a.audioCoordinates,t=a.cssCanvasWidth,i=a.cssCanvasHeight,o=a.dpr,s=n.data.canvas.getContext("2d"),u=n.data.canvas;if(null!==n.data.canvas){u.width=t*o,u.height=i*o,null===s||void 0===s||s.scale(o,o),null===s||void 0===s||s.translate(0,i/2);var c=t/r.length;s.strokeStyle="red",s.beginPath();for(var d=0;d<r.length;d++){var l=c*d,f=r[d];e(s,l,f,c)}postMessage({audioCoordinates:r})}};var e=function(e,n,a,r){e.fillRect(n+r/2,-a/2,2,a),e.fillStyle="red"}})),a(3502)),w=a(3730),C=a(3214),I=function(){var e=(0,t.Z)((0,r.Z)().mark((function e(n){var a,t,i,o,s,u,c,d;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.imageFile,t=n.audioFile,i=n.audioCoordinates,o=n.packId,s=n.fileId,u=n.duration,e.prev=1,!a||!t){e.next=12;break}return(c=new FormData).append("image",a),c.append("audio",t),c.append("coordinates",JSON.stringify(i)),c.append("duration",JSON.stringify(u)),e.next=10,C.S.create({packId:o,fileId:s},c).promise;case 10:return d=e.sent,e.abrupt("return",d);case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),console.log(e.t0);case 17:case"end":return e.stop()}}),e,null,[[1,14]])})));return function(n){return e.apply(this,arguments)}}(),b=a(6581),_=a(184),j=function(e){var n=e.file,a=e.fileId,i=(0,s.v9)(d),u=function(){var e="Other",n=function(e){return navigator.userAgent.indexOf(e)};if(-1!==n("YaBrowser"))e="Yandex Browser";else if(-1!==n("Firefox"))e="Mozilla Firefox";else if(-1!==n("MSIE"))e="Internet Exploder";else if(-1!==n("Edge"))e="Microsoft Edge";else if(-1!==n("Safari")){if(-1!==n("Chrome")&&-1!==n("Safari"))return"Chrome";e="Safari"}else-1!==n("Opera")&&(e="Opera");return e}(),c=(0,b.T)(),l=(0,o.useRef)(null);return(0,o.useEffect)((function(){var e=new FileReader;e.readAsArrayBuffer(n),e.onload=(0,t.Z)((0,r.Z)().mark((function e(){var o,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:window.AudioContext=window.AudioContext||new window.webkitAudioContext,o=new AudioContext,(s=new FileReader).readAsArrayBuffer(n),s.onload=function(){var e=s.result;e&&o.decodeAudioData(e).then(function(){var e=(0,t.Z)((0,r.Z)().mark((function e(t){var o,s,d,f,p;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=h.sampleAudioData(t),"Safari"!==u){e.next=14;break}if(s=null===l||void 0===l?void 0:l.current,d=y.X.drawingCanvasToImage(n,o,i,s,a,t.duration)){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,I(d);case 8:if(f=e.sent){e.next=11;break}return e.abrupt("return");case 11:c((0,w.b2)(f)),e.next=18;break;case 14:if(null!==l&&void 0!==l&&l.current){e.next=16;break}return e.abrupt("return");case 16:p=null===l||void 0===l?void 0:l.current.transferControlToOffscreen(),k.postMessage({audioFile:n,audioCoordinates:o,packId:i,canvas:p,cssCanvasWidth:550,cssCanvasHeight:50,dpr:2,fileId:a,duration:t.duration},[p]);case 18:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}())};case 5:case"end":return e.stop()}}),e)})))}),[]),(0,_.jsx)(_.Fragment,{children:(0,_.jsx)("canvas",{ref:l,style:{width:"550px",height:"35px"}})})},D=function(){var e=(0,s.v9)(c);return(0,_.jsx)(_.Fragment,{children:e.map((function(e,n){var a=e.file,r=e.id;return(0,_.jsx)(j,{file:a,fileId:r},n)}))})},S=a(7689),E=new Uint8Array(16);function F(){if(!m&&!(m="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!==typeof msCrypto&&"function"===typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return m(E)}var A=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var O=function(e){return"string"===typeof e&&A.test(e)},P=[],Z=0;Z<256;++Z)P.push((Z+256).toString(16).substr(1));var L=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=(P[e[n+0]]+P[e[n+1]]+P[e[n+2]]+P[e[n+3]]+"-"+P[e[n+4]]+P[e[n+5]]+"-"+P[e[n+6]]+P[e[n+7]]+"-"+P[e[n+8]]+P[e[n+9]]+"-"+P[e[n+10]]+P[e[n+11]]+P[e[n+12]]+P[e[n+13]]+P[e[n+14]]+P[e[n+15]]).toLowerCase();if(!O(a))throw TypeError("Stringified UUID is invalid");return a};var R=function(e,n,a){var r=(e=e||{}).random||(e.rng||F)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,n){a=a||0;for(var t=0;t<16;++t)n[a+t]=r[t];return n}return L(r)},U=a(2419),M=a(3484),N=a(4797),T="UserPackItem_drop__iQWB7",B="UserPackItem_dropSamples__bEFD2",W="UserPackItem_packCardWrapper__XeXuI",z="UserPackItem_packCard__nBKIZ",H="UserPackItem_changePage__UrzTT",V="UserPackItem_uploadSamples__+sldL",X=function(e){var n=e.pack,a=(e.index,e.id),r=(0,U.u)(),t=r.drag,i=r.setDrag,s=r.dragEnter,u=r.dragLeave,c=(0,o.useRef)(null),d=(0,S.s0)(),l=(0,b.T)();return(0,_.jsxs)("div",{className:"".concat(W," ").concat(H),children:[(0,_.jsxs)("div",{className:z,onClick:function(){return d("/profile-pack/".concat(null===n||void 0===n?void 0:n._id))},children:[(0,_.jsx)("img",{src:"".concat(n.picture),alt:"pack-cover"}),(0,_.jsxs)("div",{children:[(0,_.jsx)("div",{children:n.genre}),(0,_.jsx)("div",{style:{fontSize:12,color:"gray"},children:n.name})]})]}),(0,_.jsx)("div",{className:B,children:t?(0,_.jsx)("div",{className:T,onDragEnter:s,onDragLeave:u,onDragOver:s,onDrop:function(e){e.preventDefault(),e.stopPropagation();var n=[e.dataTransfer.files];console.log(n),i(!1),Object.values(n[0]).forEach((function(e){l((0,w.HP)({id:R(),file:e,packId:a}))}))},children:"DROP FILES"}):(0,_.jsx)("div",{onDragEnter:s,onDragLeave:u,onDragOver:s,children:"DOWNLOAD SAMPLES"})}),(0,_.jsxs)("div",{onClick:function(){var e;return null===(e=c.current)||void 0===e?void 0:e.click()},className:V,children:[(0,_.jsx)("input",{type:"file",accept:"audio/wav",style:{display:"none"},ref:c,multiple:!0,onChange:function(e){e.target.files&&Object.values(e.target.files).forEach((function(e){l((0,w.HP)({id:R(),file:e,packId:a}))}))}}),(0,_.jsxs)(M._,{typeStyle:"download",children:[(0,_.jsx)(N._,{iconName:"upload"}),"DOWNLOAD SAMPLES"]})]})]})},J=a(8003),Q=a(2002),Y=a(2850),K=a(4261),$="UserPacksPage_root__ICou2",q="UserPacksPage_packCardContainer__t5FQp",G=function(){var e=(0,s.v9)(J.zL),n=(0,s.v9)(l),a=(0,o.useState)(!1),u=(0,i.Z)(a,2),c=u[0],d=u[1],f=(0,b.T)();return(0,o.useEffect)((function(){null!==n&&void 0!==n&&n.length?d(!0):d(!1)}),[n]),(0,o.useEffect)((function(){function e(e){return n.apply(this,arguments)}function n(){return(n=(0,t.Z)((0,r.Z)().mark((function e(n){var a,t,i,o,s,u,c,d;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.data,t=a.imageFile,i=a.audioFile,o=a.audioCoordinates,s=a.packId,u=a.fileId,c=a.duration,e.next=3,I({imageFile:t,audioFile:i,audioCoordinates:o,packId:s,fileId:u,duration:c});case 3:if(d=e.sent){e.next=6;break}return e.abrupt("return");case 6:f((0,w.b2)(d));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return k.addEventListener("message",e),f((0,K.BD)()),function(){k.removeEventListener("message",e)}}),[]),(0,_.jsx)("div",{"data-testid":"user-packs-page",children:(0,_.jsxs)("div",{className:$,children:[(0,_.jsx)(Y.u,{setActive:d,active:c,children:(0,_.jsx)(Q.a,{customColor:"secondary"})}),e.map((function(e,n){return(0,_.jsx)("div",{className:q,children:(0,_.jsx)(X,{pack:e,id:e._id,index:n})},e._id)})),(0,_.jsx)("div",{}),(0,_.jsx)(D,{})]})})}}}]);
//# sourceMappingURL=658.c187d6e9.chunk.js.map